ARG VERSION=latest
FROM connectedhomeip/chip-build-esp32:${VERSION} as build

RUN set -x \
    && git clone --depth 1 https://github.com/project-chip/connectedhomeip.git /opt/espressif/connectedhomeip \
    && : # last line

ENV CHIP_PATH=/opt/espressif/connectedhomeip
WORKDIR /opt/espressif/connectedhomeip

RUN set -x \
    && scripts/checkout_submodules.py --platform esp32 --shallow \
    && : # last line

RUN set -x \
    && scripts/build/gn_bootstrap.sh \
    && : # last line
